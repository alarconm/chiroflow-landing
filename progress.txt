ChiroFlow Ralph Progress Log
============================

2026-01-22: US-264 - Mobile API layer
-------------------------------------
Implemented complete mobile API infrastructure for Epic 27 (Mobile Applications).

Files Created:
- app/prisma/schema.prisma (updated with mobile models)
- app/src/lib/mobile-auth.ts - JWT authentication library with access/refresh tokens
- app/src/lib/mobile-rate-limit.ts - Rate limiting middleware for mobile endpoints
- app/src/server/routers/mobile.ts - tRPC router with mobile-specific procedures
- app/src/app/api/mobile/v1/auth/login/route.ts - REST login endpoint
- app/src/app/api/mobile/v1/auth/refresh/route.ts - REST token refresh endpoint
- app/src/app/api/mobile/v1/auth/logout/route.ts - REST logout endpoint
- app/src/app/api/mobile/v1/devices/route.ts - Device registration/management
- app/src/app/api/mobile/v1/sync/push/route.ts - Offline sync push endpoint
- app/src/app/api/mobile/v1/sync/pull/route.ts - Offline sync pull endpoint
- app/src/app/api/mobile/v1/notifications/register/route.ts - Push notification registration
- app/src/app/api/mobile/v1/status/route.ts - API status/health check

Prisma Models Added:
- MobileDevice - Device registration with FCM/APNS tokens
- MobileRefreshToken - JWT refresh token storage with rotation support
- MobileRateLimit - Rate limiting tracking
- OfflineSyncQueue - Offline-first sync queue
- PushNotification - Push notification tracking

Key Features:
1. JWT authentication with 15-minute access tokens and 30-day refresh tokens
2. Refresh token rotation for security (detects replay attacks)
3. Rate limiting per user/device/IP with automatic blocking
4. API versioning (v1) with version headers
5. Offline-first sync with conflict resolution support
6. Push notification device registration (FCM + APNS)
7. Multi-device management with trust levels

All acceptance criteria met:
✓ REST API wrapper over tRPC for mobile
✓ JWT authentication for mobile
✓ Refresh token flow
✓ API versioning
✓ Rate limiting for mobile
✓ Offline-first data sync endpoints
✓ Push notification registration endpoint
