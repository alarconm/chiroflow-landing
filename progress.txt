# ChiroFlow Ralph Progress Log

## Epic 37: AI Practice Growth Agent

### US-355: AI practice growth schema
**Status:** COMPLETED
**Date:** 2026-01-22

**Changes made:**
1. Added new enums for AI Practice Growth:
   - GrowthLeadStatus (NEW, SCORING, HOT, WARM, COLD, NURTURING, READY, CONVERTED, LOST)
   - GrowthCampaignType (LEAD_GENERATION, REACTIVATION, REFERRAL, REVIEW, RETENTION, UPSELL, SEASONAL, EVENT)
   - GrowthCampaignStatus (DRAFT, SCHEDULED, ACTIVE, PAUSED, COMPLETED, CANCELLED)
   - ReferralOpportunityStatus (IDENTIFIED, PENDING, CONTACTED, ENGAGED, REFERRED, EXPIRED, DECLINED)

2. Created new models:
   - **GrowthLead**: AI-managed lead scoring and tracking with quality scores, conversion probability, behavioral data, and nurturing tracking
   - **GrowthLeadActivity**: Activity tracking for growth leads (score updates, status changes, communications)
   - **GrowthCampaign**: AI-driven growth campaigns with targeting, goals, budget, content strategy, and performance metrics
   - **ReferralOpportunity**: AI-identified referral candidates with NPS/satisfaction scores, outreach tracking, and optimal timing
   - **ReputationMetric**: Platform-specific reputation monitoring (Google, Yelp, Facebook, Healthgrades) with sentiment analysis
   - **ReactivationOpportunity**: Lapsed patient tracking with lapse analysis, recommended approaches, and outreach tracking
   - **GrowthMetric**: Practice growth KPIs (new patients, referrals, reactivations, reviews, conversion rates)

3. Updated Organization model with relations:
   - growthLeads, growthCampaigns, referralOpportunities, reputationMetrics, reactivationOpportunities, growthMetrics

4. Updated Patient model with relations:
   - referralOpportunities, reactivationOpportunities

5. Prisma client generated successfully and schema pushed to database

**Notes:**
- The existing Lead, LeadActivity, ReviewRequest, and Campaign models from Epic 18 (Marketing) remain unchanged
- The new GrowthLead and GrowthCampaign models are specifically for AI-driven automation with enhanced scoring and behavioral tracking
- All models follow existing patterns with proper organization scoping and indexes
--- Iteration 1 completed at 2026-01-22 16:41:18 ---
Story: US-355 - AI practice growth schema

### US-356: Intelligent lead management
**Status:** COMPLETED
**Date:** 2026-01-22

**Changes made:**
1. Created new tRPC router `app/src/server/routers/aiGrowth.ts` with comprehensive lead management:
   - **aiGrowth.scoreLead** - Calculate lead quality score (0-100), conversion probability, and urgency score
   - **aiGrowth.captureLead** - Auto-capture leads from website, phone calls, referrals, walk-ins, and ads
   - **aiGrowth.listLeads** - List leads with filtering by status, quality score, source, and assignment
   - **aiGrowth.getPriorityRankings** - Get priority-ranked leads for follow-up
   - **aiGrowth.getConversionPrediction** - Detailed conversion prediction with factors and recommended actions
   - **aiGrowth.autoAssignLead** - Auto-assign leads to staff based on availability and conversion rate
   - **aiGrowth.triggerNurturing** - Start nurturing sequences (awareness, consideration, decision, re-engagement)
   - **aiGrowth.trackConversion** - Track lead conversion to patient with value tracking
   - **aiGrowth.updateLeadStatus** - Manually update lead status
   - **aiGrowth.bulkScoreLeads** - Bulk score multiple leads at once
   - **aiGrowth.getLeadActivity** - Get lead activity history
   - **aiGrowth.getSourceAnalytics** - Analytics by lead source

2. Lead scoring algorithm includes:
   - Website visits (0-20 points)
   - Page views (0-15 points)
   - Time on site (0-15 points)
   - Form interaction (0-15 points)
   - Email engagement (0-15 points)
   - Source quality (0-20 points) - referrals score highest

3. Intent signal detection:
   - Multiple site visits
   - Extensive page browsing
   - Long session times
   - Form abandonment (high intent with friction)
   - Pricing/insurance/scheduling page views

4. Auto-assignment algorithm:
   - Considers current lead count (lower = better)
   - Considers conversion rate (higher = better)
   - High-value leads go to high performers

5. Added audit actions to `app/src/lib/audit.ts`:
   - AI_GROWTH_LEAD_CAPTURED, AI_GROWTH_LEAD_SCORED, AI_GROWTH_LEAD_ASSIGNED
   - AI_GROWTH_LEAD_STATUS_UPDATED, AI_GROWTH_LEAD_CONVERTED
   - AI_GROWTH_NURTURE_STARTED, AI_GROWTH_BULK_SCORE

6. Registered router in `app/src/server/routers/index.ts`

**Acceptance Criteria Met:**
- ✅ aiGrowth.scoreLead - Calculate lead quality score
- ✅ Auto-capture leads from website, calls, referrals
- ✅ Lead source tracking
- ✅ Conversion probability prediction
- ✅ Priority ranking for follow-up
- ✅ Auto-assign to appropriate staff
- ✅ Lead nurturing sequence trigger
- ✅ Conversion tracking

--- Iteration 2 completed at 2026-01-22 ---
Story: US-356 - Intelligent lead management

--- Iteration 2 completed at 2026-01-22 16:51:55 ---
Story: US-356 - Intelligent lead management

### US-357: Automated lead nurturing
**Status:** COMPLETED
**Date:** 2026-01-22

**Changes made:**
1. Extended `app/src/server/routers/aiGrowth.ts` with comprehensive lead nurturing functionality:
   - **aiGrowth.nurtureLead** - Start or continue nurturing with personalized sequences
   - **aiGrowth.advanceNurtureStep** - Advance lead to next step in sequence
   - **aiGrowth.recordNurtureEngagement** - Track email opens, link clicks, replies
   - **aiGrowth.handleLeadResponse** - Process responses and determine next actions
   - **aiGrowth.getOptimalTiming** - Calculate best send times based on engagement
   - **aiGrowth.getNurtureSequences** - Get available sequences with recommendations
   - **aiGrowth.pauseNurture** - Pause nurturing for a lead
   - **aiGrowth.resumeNurture** - Resume nurturing from where left off
   - **aiGrowth.escalateHotLead** - Escalate hot leads to staff immediately
   - **aiGrowth.getNurtureAnalytics** - Get performance metrics for sequences

2. Created 4 pre-built nurture sequence templates:
   - **Awareness Sequence** (5 steps) - Educational content for new leads
   - **Consideration Sequence** (4 steps) - Case studies and testimonials
   - **Decision Sequence** (3 steps) - Special offers for ready-to-book leads
   - **Re-engagement Sequence** (3 steps) - Win-back campaign for cold leads

3. Added intelligent features:
   - **Personalized content** - Dynamic variables ({{firstName}}, {{practiceName}}, etc.)
   - **Optimal timing calculation** - Best day/time based on engagement patterns
   - **Sentiment analysis** - Detect positive/negative/neutral responses
   - **Engagement scoring** - Calculate lead engagement (0-100)
   - **Auto-escalation** - Hot leads automatically flagged for staff follow-up
   - **Multi-channel support** - Email and SMS nurturing

4. Added new audit actions to `app/src/lib/audit.ts`:
   - AI_GROWTH_NURTURE_ADVANCED, AI_GROWTH_NURTURE_ENGAGEMENT
   - AI_GROWTH_RESPONSE_HANDLED, AI_GROWTH_NURTURE_PAUSED
   - AI_GROWTH_NURTURE_RESUMED, AI_GROWTH_LEAD_ESCALATED

**Acceptance Criteria Met:**
- ✅ aiGrowth.nurtureLead - Automated follow-up
- ✅ Personalized email sequences
- ✅ SMS follow-up campaigns
- ✅ Content delivery based on interest (sequence selection)
- ✅ Optimal timing for outreach
- ✅ Handle responses automatically (sentiment analysis + action determination)
- ✅ Escalate hot leads to staff
- ✅ Track engagement and adjust (engagement scoring, analytics)

--- Iteration 3 completed at 2026-01-22 ---
Story: US-357 - Automated lead nurturing

--- Iteration 3 completed at 2026-01-22 17:00:04 ---
Story: US-357 - Automated lead nurturing

### US-358: Reputation management
**Status:** COMPLETED
**Date:** 2026-01-22

**Changes made:**
1. Extended `app/src/server/routers/aiGrowth.ts` with comprehensive reputation management functionality:
   - **aiGrowth.requestReview** - Smart review request with personalized messaging
   - **aiGrowth.identifySatisfiedPatients** - Find best review candidates based on visit history and satisfaction
   - **aiGrowth.getReviewRequests** - List and filter review requests with stats
   - **aiGrowth.updatePlatformMetrics** - Update reputation metrics from monitoring
   - **aiGrowth.getPlatformMetrics** - Get current and historical platform metrics
   - **aiGrowth.alertNegativeReview** - Create alerts for negative reviews
   - **aiGrowth.getReviewResponseSuggestion** - Generate AI response suggestions
   - **aiGrowth.getReputationScore** - Calculate overall reputation score with analysis
   - **aiGrowth.getReputationTrends** - Track reputation trends over time
   - **aiGrowth.bulkRequestReviews** - Bulk request reviews with spread scheduling
   - **aiGrowth.acknowledgeNegativeReview** - Handle negative review alerts

2. Added 14 new types for reputation management:
   - ReviewCandidate, ReviewRequestResult, PlatformMetrics
   - ReputationScore, NegativeReviewAlert, ReviewResponseSuggestion

3. Added 10 new input schemas for validation:
   - requestReviewInputSchema, identifySatisfiedPatientsInputSchema
   - getReviewRequestsInputSchema, updatePlatformMetricsInputSchema
   - getPlatformMetricsInputSchema, alertNegativeReviewInputSchema
   - getReviewResponseSuggestionInputSchema, getReputationScoreInputSchema
   - getReputationTrendsInputSchema, bulkRequestReviewsInputSchema
   - acknowledgeNegativeReviewInputSchema

4. Added 7 helper functions:
   - calculatePatientSatisfactionScore - Score based on visit history
   - calculateOptimalReviewRequestTime - Best time to request reviews
   - generateReviewRequestMessage - Personalized email/SMS messages
   - generateReviewResponseSuggestions - AI-powered response drafts
   - calculateReputationScore - Overall score with platform weights
   - getPlatformGuidelines - Platform-specific response guidelines

5. Added new audit actions to `app/src/lib/audit.ts`:
   - AI_GROWTH_REVIEW_REQUESTED, AI_GROWTH_BULK_REVIEW_REQUEST
   - AI_GROWTH_METRICS_UPDATED, AI_GROWTH_NEGATIVE_REVIEW_ALERT
   - AI_GROWTH_REVIEW_ALERT_ACTION

**Features implemented:**
- Smart review request timing (2 days after positive appointment)
- Patient satisfaction scoring algorithm (0-100 based on visits, completion rate)
- Multi-platform support (Google, Yelp, Facebook, Healthgrades, ZocDoc)
- Personalized email and SMS templates with dynamic variables
- Negative review detection and severity classification
- AI-generated response suggestions with multiple tones
- Platform-specific response guidelines
- Reputation score calculation with trend analysis
- Review request tracking and conversion metrics
- Bulk review requests with spread scheduling

**Acceptance Criteria Met:**
- ✅ aiGrowth.requestReview - Smart review requests
- ✅ Identify satisfied patients for review ask (satisfaction scoring)
- ✅ Multi-platform review requests (Google, Yelp, Facebook)
- ✅ Optimal timing after positive experiences
- ✅ Monitor review platforms (updatePlatformMetrics, getPlatformMetrics)
- ✅ Alert on negative reviews (alertNegativeReview)
- ✅ Generate review response suggestions
- ✅ Track reputation scores (getReputationScore, getReputationTrends)

--- Iteration 4 completed at 2026-01-22 ---
Story: US-358 - Reputation management

