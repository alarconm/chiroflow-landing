{
  "branch": "feature/digital-intake",
  "title": "Epic 04: Digital Intake System",
  "description": "Paperless patient onboarding with a form builder, pre-built chiropractic templates, e-signature capture, auto-populate patient records, kiosk mode for in-office, and email/SMS form delivery.",
  "epic": "04-digital-intake",
  "userStories": [
    {
      "id": "US-033",
      "title": "Intake form database schema",
      "description": "Extend Prisma schema with models for form templates, form fields, form submissions, and e-signatures.",
      "acceptanceCriteria": [
        "FormTemplate model with name, description, version, isActive, organizationId",
        "FormField model with templateId, fieldType enum (TEXT, TEXTAREA, SELECT, CHECKBOX, DATE, SIGNATURE, etc.)",
        "FormField properties: label, placeholder, required, order, options (for select/radio), validation rules",
        "FormSection model for grouping fields (Personal Info, Medical History, Consent)",
        "FormSubmission model linking patient, template, submittedAt, status",
        "FormResponse model for individual field values (submissionId, fieldId, value)",
        "ESignature model with submissionId, signatureData (base64), signedAt, ipAddress",
        "FormDelivery model for tracking sent forms (patientId, templateId, deliveryMethod, sentAt, completedAt)",
        "Proper indexes for querying submissions by patient and template",
        "Migrations run successfully"
      ],
      "priority": 1,
      "passes": true
    },
    {
      "id": "US-034",
      "title": "Form template CRUD",
      "description": "Create tRPC routes for managing form templates with versioning support.",
      "acceptanceCriteria": [
        "formTemplate.create mutation with fields and sections",
        "formTemplate.get query returns template with all fields and sections",
        "formTemplate.update mutation preserves version history",
        "formTemplate.list query with active/inactive filter",
        "formTemplate.duplicate to create copy of existing template",
        "formTemplate.archive for soft delete (keeps submissions)",
        "formTemplate.publish to make template active",
        "All operations create audit log entries"
      ],
      "priority": 2,
      "passes": true
    },
    {
      "id": "US-035",
      "title": "Form field types and validation",
      "description": "Implement all field types with proper validation rules.",
      "acceptanceCriteria": [
        "TEXT field with min/max length, pattern validation",
        "TEXTAREA field with max length",
        "SELECT and RADIO with options array",
        "CHECKBOX for single boolean or multi-select",
        "DATE field with min/max date constraints",
        "PHONE field with format validation",
        "EMAIL field with email validation",
        "SSN field with masking (last 4 visible)",
        "SIGNATURE field for e-signature capture",
        "FILE field for document uploads",
        "HEADING and PARAGRAPH for display-only content",
        "Conditional visibility (show field B only if field A = X)"
      ],
      "priority": 3,
      "passes": true
    },
    {
      "id": "US-036",
      "title": "Pre-built chiropractic templates",
      "description": "Create seed data with common chiropractic intake forms.",
      "acceptanceCriteria": [
        "New Patient Health History form with demographics, medical history, current conditions",
        "Pain Assessment form with body diagram reference, pain scale, symptoms",
        "HIPAA Authorization form with required consent checkboxes",
        "Financial Policy form with payment terms acknowledgment",
        "Informed Consent for Treatment form",
        "Patient demographics form (auto-populates patient record)",
        "Templates marked as system templates (non-deletable)",
        "Seed script creates templates on first run"
      ],
      "priority": 4,
      "passes": true
    },
    {
      "id": "US-037",
      "title": "Form builder UI",
      "description": "Create drag-and-drop form builder interface for staff to customize templates.",
      "acceptanceCriteria": [
        "Form builder page at /settings/forms route",
        "Left sidebar with available field types",
        "Drag fields from sidebar to form canvas",
        "Reorder fields via drag-and-drop",
        "Click field to edit properties (label, required, validation)",
        "Add/edit/delete sections",
        "Preview mode to see form as patient will see it",
        "Save draft and publish workflow",
        "Duplicate existing template to create new"
      ],
      "priority": 5,
      "passes": true
    },
    {
      "id": "US-038",
      "title": "Form submission and responses",
      "description": "Handle patient form submissions with validation and storage.",
      "acceptanceCriteria": [
        "formSubmission.create mutation validates all required fields",
        "formSubmission.get returns submission with all responses",
        "formSubmission.list by patient or by template",
        "formSubmission.updateStatus for workflow (PENDING, COMPLETED, REVIEWED)",
        "Store responses as JSON for flexibility",
        "Handle file uploads with secure storage",
        "Validate field values against field rules",
        "Track submission source (kiosk, email, portal)"
      ],
      "priority": 6,
      "passes": true
    },
    {
      "id": "US-039",
      "title": "E-signature capture",
      "description": "Implement electronic signature capture with legal compliance.",
      "acceptanceCriteria": [
        "Signature pad component with touch/mouse support",
        "Clear and redo signature functionality",
        "Save signature as base64 image",
        "Record timestamp, IP address, and user agent",
        "Display signed consent text above signature field",
        "Signature required validation",
        "View captured signature in submission review",
        "Export signature as image for records"
      ],
      "priority": 7,
      "passes": true
    },
    {
      "id": "US-040",
      "title": "Auto-populate patient record",
      "description": "Map form responses to patient demographics and create/update patient records.",
      "acceptanceCriteria": [
        "Define field-to-patient mapping in template config",
        "On submission, extract mapped values",
        "Create new patient if form is for new patient",
        "Update existing patient demographics if linked",
        "Handle contact info mapping (phone, email, address)",
        "Handle insurance info mapping",
        "Handle emergency contact mapping",
        "Show confirmation of what will be updated before saving"
      ],
      "priority": 8,
      "passes": true
    },
    {
      "id": "US-041",
      "title": "Patient form filling UI",
      "description": "Create the patient-facing form interface for completing intake forms.",
      "acceptanceCriteria": [
        "Public form page at /forms/[token] route",
        "Token-based access (no login required)",
        "Mobile-responsive form layout",
        "Progress indicator for multi-section forms",
        "Save progress and resume later",
        "Field validation with inline error messages",
        "Submit confirmation page",
        "Accessible design (WCAG 2.1 AA)",
        "Form expires after configurable time"
      ],
      "priority": 9,
      "passes": true
    },
    {
      "id": "US-042",
      "title": "Kiosk mode",
      "description": "Create a tablet-friendly kiosk mode for in-office form completion.",
      "acceptanceCriteria": [
        "Kiosk page at /kiosk route",
        "Full-screen mode without browser chrome",
        "Large touch-friendly UI elements",
        "Patient lookup by name/DOB or scan QR code",
        "Show pending forms for the patient",
        "Auto-logout after form submission",
        "Session timeout with inactivity warning",
        "PIN protection to exit kiosk mode"
      ],
      "priority": 10,
      "passes": true
    },
    {
      "id": "US-043",
      "title": "Form delivery via email/SMS",
      "description": "Send forms to patients via email or SMS before their appointment.",
      "acceptanceCriteria": [
        "formDelivery.send mutation with patientId, templateIds, method",
        "Generate unique secure token for form access",
        "Email template with form link and instructions",
        "SMS with short link to form",
        "Track delivery status (sent, opened, completed)",
        "Reminder if form not completed",
        "Bulk send forms to multiple patients",
        "Schedule send for future date/time"
      ],
      "priority": 11,
      "passes": true
    },
    {
      "id": "US-044",
      "title": "Form submission review UI",
      "description": "Create interface for staff to review and process completed forms.",
      "acceptanceCriteria": [
        "Submissions list page at /settings/forms/submissions",
        "Filter by status, template, date range",
        "View individual submission with all responses",
        "Side-by-side view of form and patient record",
        "Mark submission as reviewed",
        "Add staff notes to submission",
        "Print submission as PDF",
        "Link submission to appointment if applicable"
      ],
      "priority": 12,
      "passes": false
    }
  ]
}
